"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/assertThisInitialized"),t=require("@babel/runtime/helpers/inheritsLoose"),n=require("@babel/runtime/helpers/defineProperty"),a=require("three");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e),i=o(t),l=o(n),u=function(e){function t(t,n){var o;o=e.call(this)||this,l.default(r.default(o),"isTransformControls",!0),l.default(r.default(o),"visible",!1),l.default(r.default(o),"domElement",void 0),l.default(r.default(o),"raycaster",new a.Raycaster),l.default(r.default(o),"_gizmo",void 0),l.default(r.default(o),"_plane",void 0),l.default(r.default(o),"_tempVector",new a.Vector3),l.default(r.default(o),"_tempVector2",new a.Vector3),l.default(r.default(o),"_tempQuaternion",new a.Quaternion),l.default(r.default(o),"_unit",{X:new a.Vector3(1,0,0),Y:new a.Vector3(0,1,0),Z:new a.Vector3(0,0,1)}),l.default(r.default(o),"_pointStart",new a.Vector3),l.default(r.default(o),"_pointEnd",new a.Vector3),l.default(r.default(o),"_offset",new a.Vector3),l.default(r.default(o),"_rotationAxis",new a.Vector3),l.default(r.default(o),"_startNorm",new a.Vector3),l.default(r.default(o),"_endNorm",new a.Vector3),l.default(r.default(o),"_rotationAngle",0),l.default(r.default(o),"_cameraPosition",new a.Vector3),l.default(r.default(o),"_cameraQuaternion",new a.Quaternion),l.default(r.default(o),"_cameraScale",new a.Vector3),l.default(r.default(o),"_parentPosition",new a.Vector3),l.default(r.default(o),"_parentQuaternion",new a.Quaternion),l.default(r.default(o),"_parentQuaternionInv",new a.Quaternion),l.default(r.default(o),"_parentScale",new a.Vector3),l.default(r.default(o),"_worldPositionStart",new a.Vector3),l.default(r.default(o),"_worldQuaternionStart",new a.Quaternion),l.default(r.default(o),"_worldScaleStart",new a.Vector3),l.default(r.default(o),"_worldPosition",new a.Vector3),l.default(r.default(o),"_worldQuaternion",new a.Quaternion),l.default(r.default(o),"_worldQuaternionInv",new a.Quaternion),l.default(r.default(o),"_worldScale",new a.Vector3),l.default(r.default(o),"_eye",new a.Vector3),l.default(r.default(o),"_positionStart",new a.Vector3),l.default(r.default(o),"_quaternionStart",new a.Quaternion),l.default(r.default(o),"_scaleStart",new a.Vector3),l.default(r.default(o),"_camera",void 0),l.default(r.default(o),"_object",void 0),l.default(r.default(o),"_enabled",!0),l.default(r.default(o),"_axis",null),l.default(r.default(o),"_mode","translate"),l.default(r.default(o),"_translationSnap",null),l.default(r.default(o),"_rotationSnap",null),l.default(r.default(o),"_scaleSnap",null),l.default(r.default(o),"_space","world"),l.default(r.default(o),"_size",1),l.default(r.default(o),"_dragging",!1),l.default(r.default(o),"_showX",!0),l.default(r.default(o),"_showY",!0),l.default(r.default(o),"_showZ",!0),l.default(r.default(o),"changeEvent",{type:"change"}),l.default(r.default(o),"mouseDownEvent",{type:"mouseDown"}),l.default(r.default(o),"mouseUpEvent",{type:"mouseUp",mode:o._mode}),l.default(r.default(o),"objectChangeEvent",{type:"objectChange"}),l.default(r.default(o),"intersectObjectWithRay",(function(e,t,n){for(var a=t.intersectObject(e,!0),o=0;o<a.length;o++)if(a[o].object.visible||n)return a[o];return!1})),l.default(r.default(o),"attach",(function(e){return o._object=e,o.visible=!0,r.default(o)})),l.default(r.default(o),"detach",(function(){return o._object=void 0,o.visible=!1,o._axis=null,r.default(o)})),l.default(r.default(o),"updateMatrixWorld",(function(){void 0!==o._object&&(o._object.updateMatrixWorld(),null===o._object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):o._object.parent.matrixWorld.decompose(o._parentPosition,o._parentQuaternion,o._parentScale),o._object.matrixWorld.decompose(o._worldPosition,o._worldQuaternion,o._worldScale),o._parentQuaternionInv.copy(o._parentQuaternion).invert(),o._worldQuaternionInv.copy(o._worldQuaternion).invert()),o._camera.updateMatrixWorld(),o._camera.matrixWorld.decompose(o._cameraPosition,o._cameraQuaternion,o._cameraScale),o._eye.copy(o._cameraPosition).sub(o._worldPosition).normalize(),e.prototype.updateMatrixWorld.call(r.default(o))})),l.default(r.default(o),"pointerHover",(function(e){if(void 0!==o._object&&!0!==o._dragging){o.raycaster.setFromCamera(e,o._camera);var t=o.intersectObjectWithRay(o._gizmo.picker[o._mode],o.raycaster);o._axis=t?t.object.name:null}})),l.default(r.default(o),"pointerDown",(function(e){if(void 0!==o._object&&!0!==o._dragging&&0===e.button&&null!==o._axis){o.raycaster.setFromCamera(e,o._camera);var t=o.intersectObjectWithRay(o._plane,o.raycaster,!0);if(t){var n=o._space;if("scale"===o._mode?n="local":"E"!==o._axis&&"XYZE"!==o._axis&&"XYZ"!==o._axis||(n="world"),"local"===n&&"rotate"===o._mode){var a=o._rotationSnap;"X"===o._axis&&a&&(o._object.rotation.x=Math.round(o._object.rotation.x/a)*a),"Y"===o._axis&&a&&(o._object.rotation.y=Math.round(o._object.rotation.y/a)*a),"Z"===o._axis&&a&&(o._object.rotation.z=Math.round(o._object.rotation.z/a)*a)}o._object.updateMatrixWorld(),o._object.parent&&o._object.parent.updateMatrixWorld(),o._positionStart.copy(o._object.position),o._quaternionStart.copy(o._object.quaternion),o._scaleStart.copy(o._object.scale),o._object.matrixWorld.decompose(o._worldPositionStart,o._worldQuaternionStart,o._worldScaleStart),o._pointStart.copy(t.point).sub(o._worldPositionStart)}o._dragging=!0,o.mouseDownEvent.type=o._mode,o.dispatchEvent(o.mouseDownEvent)}})),l.default(r.default(o),"pointerMove",(function(e){var t=o._axis,n=o._mode,a=o._object,r=o._space;if("scale"===n?r="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(r="world"),void 0!==a&&null!==t&&!1!==o._dragging&&-1===e.button){o.raycaster.setFromCamera(e,o._camera);var i=o.intersectObjectWithRay(o._plane,o.raycaster,!0);if(i){if(o._pointEnd.copy(i.point).sub(o._worldPositionStart),"translate"===n)o._offset.copy(o._pointEnd).sub(o._pointStart),"local"===r&&"XYZ"!==t&&o._offset.applyQuaternion(o._worldQuaternionInv),-1===t.indexOf("X")&&(o._offset.x=0),-1===t.indexOf("Y")&&(o._offset.y=0),-1===t.indexOf("Z")&&(o._offset.z=0),"local"===r&&"XYZ"!==t?o._offset.applyQuaternion(o._quaternionStart).divide(o._parentScale):o._offset.applyQuaternion(o._parentQuaternionInv).divide(o._parentScale),a.position.copy(o._offset).add(o._positionStart),o._translationSnap&&("local"===r&&(a.position.applyQuaternion(o._tempQuaternion.copy(o._quaternionStart).invert()),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/o._translationSnap)*o._translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/o._translationSnap)*o._translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/o._translationSnap)*o._translationSnap),a.position.applyQuaternion(o._quaternionStart)),"world"===r&&(a.parent&&a.position.add(o._tempVector.setFromMatrixPosition(a.parent.matrixWorld)),-1!==t.search("X")&&(a.position.x=Math.round(a.position.x/o._translationSnap)*o._translationSnap),-1!==t.search("Y")&&(a.position.y=Math.round(a.position.y/o._translationSnap)*o._translationSnap),-1!==t.search("Z")&&(a.position.z=Math.round(a.position.z/o._translationSnap)*o._translationSnap),a.parent&&a.position.sub(o._tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var l=o._pointEnd.length()/o._pointStart.length();o._pointEnd.dot(o._pointStart)<0&&(l*=-1),o._tempVector2.set(l,l,l)}else o._tempVector.copy(o._pointStart),o._tempVector2.copy(o._pointEnd),o._tempVector.applyQuaternion(o._worldQuaternionInv),o._tempVector2.applyQuaternion(o._worldQuaternionInv),o._tempVector2.divide(o._tempVector),-1===t.search("X")&&(o._tempVector2.x=1),-1===t.search("Y")&&(o._tempVector2.y=1),-1===t.search("Z")&&(o._tempVector2.z=1);a.scale.copy(o._scaleStart).multiply(o._tempVector2),o._scaleSnap&&o._object&&(-1!==t.search("X")&&(o._object.scale.x=Math.round(a.scale.x/o._scaleSnap)*o._scaleSnap||o._scaleSnap),-1!==t.search("Y")&&(a.scale.y=Math.round(a.scale.y/o._scaleSnap)*o._scaleSnap||o._scaleSnap),-1!==t.search("Z")&&(a.scale.z=Math.round(a.scale.z/o._scaleSnap)*o._scaleSnap||o._scaleSnap))}else if("rotate"===n){o._offset.copy(o._pointEnd).sub(o._pointStart);var u=20/o._worldPosition.distanceTo(o._tempVector.setFromMatrixPosition(o._camera.matrixWorld));"E"===t?(o._rotationAxis.copy(o._eye),o._rotationAngle=o._pointEnd.angleTo(o._pointStart),o._startNorm.copy(o._pointStart).normalize(),o._endNorm.copy(o._pointEnd).normalize(),o._rotationAngle*=o._endNorm.cross(o._startNorm).dot(o._eye)<0?1:-1):"XYZE"===t?(o._rotationAxis.copy(o._offset).cross(o._eye).normalize(),o._rotationAngle=o._offset.dot(o._tempVector.copy(o._rotationAxis).cross(o._eye))*u):"X"!==t&&"Y"!==t&&"Z"!==t||(o._rotationAxis.copy(o._unit[t]),o._tempVector.copy(o._unit[t]),"local"===r&&o._tempVector.applyQuaternion(o._worldQuaternion),o._rotationAngle=o._offset.dot(o._tempVector.cross(o._eye).normalize())*u),o._rotationSnap&&(o._rotationAngle=Math.round(o._rotationAngle/o._rotationSnap)*o._rotationSnap),"local"===r&&"E"!==t&&"XYZE"!==t?(a.quaternion.copy(o._quaternionStart),a.quaternion.multiply(o._tempQuaternion.setFromAxisAngle(o._rotationAxis,o._rotationAngle)).normalize()):(o._rotationAxis.applyQuaternion(o._parentQuaternionInv),a.quaternion.copy(o._tempQuaternion.setFromAxisAngle(o._rotationAxis,o._rotationAngle)),a.quaternion.multiply(o._quaternionStart).normalize())}o.dispatchEvent(o.changeEvent),o.dispatchEvent(o.objectChangeEvent)}}})),l.default(r.default(o),"pointerUp",(function(e){0===e.button&&(o._dragging&&null!==o._axis&&(o.mouseUpEvent.mode=o._mode,o.dispatchEvent(o.mouseUpEvent)),o._dragging=!1,o._axis=null)})),l.default(r.default(o),"getPointer",(function(e){var t;if(o.domElement&&null!==(t=o.domElement.ownerDocument)&&void 0!==t&&t.pointerLockElement)return{x:0,y:0,button:e.button};var n,a=e.changedTouches?e.changedTouches[0]:e,r=null===(n=o.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(a.clientX-r.left)/r.width*2-1,y:-(a.clientY-r.top)/r.height*2+1,button:e.button}})),l.default(r.default(o),"onPointerHover",(function(e){if(o._enabled)switch(e.pointerType){case"mouse":case"pen":o.pointerHover(o.getPointer(e))}})),l.default(r.default(o),"onPointerDown",(function(e){var t;o._enabled&&(o.domElement.style.touchAction="none",null===(t=o.domElement.ownerDocument)||void 0===t||t.addEventListener("pointermove",o.onPointerMove),o.pointerHover(o.getPointer(e)),o.pointerDown(o.getPointer(e)))})),l.default(r.default(o),"onPointerMove",(function(e){o._enabled&&o.pointerMove(o.getPointer(e))})),l.default(r.default(o),"onPointerUp",(function(e){var t;o._enabled&&(o.domElement.style.touchAction="",null===(t=o.domElement.ownerDocument)||void 0===t||t.removeEventListener("pointermove",o.onPointerMove),o.pointerUp(o.getPointer(e)))})),l.default(r.default(o),"getMode",(function(){return o._mode})),l.default(r.default(o),"setMode",(function(e){o._mode=e})),l.default(r.default(o),"setTranslationSnap",(function(e){o._translationSnap=e})),l.default(r.default(o),"setRotationSnap",(function(e){o._rotationSnap=e})),l.default(r.default(o),"setScaleSnap",(function(e){o._scaleSnap=e})),l.default(r.default(o),"setSize",(function(e){o._size=e})),l.default(r.default(o),"setSpace",(function(e){o._space=e})),l.default(r.default(o),"update",(function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")})),l.default(r.default(o),"dispose",(function(){var e,t;o.domElement.removeEventListener("pointerdown",o.onPointerDown),o.domElement.removeEventListener("pointermove",o.onPointerHover),null===(e=o.domElement.ownerDocument)||void 0===e||e.removeEventListener("pointermove",o.onPointerMove),null===(t=o.domElement.ownerDocument)||void 0===t||t.removeEventListener("pointerup",o.onPointerUp),o.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))})),void 0===n&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),o.domElement=document),o.domElement=n,o._camera=t,o._gizmo=new d,o.add(o._gizmo),o._plane=new s,o.add(o._plane);var i=function(e,t){var n=t;Object.defineProperty(r.default(o),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this._plane[e]=t,this._gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),o[e]=t,o._plane[e]=t,o._gizmo[e]=t};return i("_camera",o._camera),i("_object",o._object),i("_enabled",o._enabled),i("_axis",o._axis),i("_mode",o._mode),i("_translationSnap",o._translationSnap),i("_rotationSnap",o._rotationSnap),i("_scaleSnap",o._scaleSnap),i("_space",o._space),i("_size",o._size),i("_dragging",o._dragging),i("_showX",o._showX),i("_showY",o._showY),i("_showZ",o._showZ),i("_worldPosition",o._worldPosition),i("_worldPositionStart",o._worldPositionStart),i("_worldQuaternion",o._worldQuaternion),i("_worldQuaternionStart",o._worldQuaternionStart),i("_cameraPosition",o._cameraPosition),i("_cameraQuaternion",o._cameraQuaternion),i("_pointStart",o._pointStart),i("_pointEnd",o._pointEnd),i("_rotationAxis",o._rotationAxis),i("_rotationAngle",o._rotationAngle),i("_eye",o._eye),n.addEventListener("pointerdown",o.onPointerDown),n.addEventListener("pointermove",o.onPointerHover),o.domElement.ownerDocument.addEventListener("pointerup",o.onPointerUp),o}return i.default(t,e),t}(a.Object3D),d=function(e){function t(){var t;t=e.call(this)||this,l.default(r.default(t),"isTransformControlsGizmo",!0),l.default(r.default(t),"type","TransformControlsGizmo"),l.default(r.default(t),"tempVector",new a.Vector3(0,0,0)),l.default(r.default(t),"tempEuler",new a.Euler),l.default(r.default(t),"alignVector",new a.Vector3(0,1,0)),l.default(r.default(t),"zeroVector",new a.Vector3(0,0,0)),l.default(r.default(t),"lookAtMatrix",new a.Matrix4),l.default(r.default(t),"tempQuaternion",new a.Quaternion),l.default(r.default(t),"tempQuaternion2",new a.Quaternion),l.default(r.default(t),"identityQuaternion",new a.Quaternion),l.default(r.default(t),"unitX",new a.Vector3(1,0,0)),l.default(r.default(t),"unitY",new a.Vector3(0,1,0)),l.default(r.default(t),"unitZ",new a.Vector3(0,0,1)),l.default(r.default(t),"gizmo",void 0),l.default(r.default(t),"picker",void 0),l.default(r.default(t),"helper",void 0),l.default(r.default(t),"_rotationAxis",new a.Vector3),l.default(r.default(t),"_cameraPosition",new a.Vector3),l.default(r.default(t),"_worldPositionStart",new a.Vector3),l.default(r.default(t),"_worldQuaternionStart",new a.Quaternion),l.default(r.default(t),"_worldPosition",new a.Vector3),l.default(r.default(t),"_worldQuaternion",new a.Quaternion),l.default(r.default(t),"_eye",new a.Vector3),l.default(r.default(t),"_camera",null),l.default(r.default(t),"_enabled",!0),l.default(r.default(t),"_axis",null),l.default(r.default(t),"_mode","translate"),l.default(r.default(t),"_space","world"),l.default(r.default(t),"_size",1),l.default(r.default(t),"_dragging",!1),l.default(r.default(t),"_showX",!0),l.default(r.default(t),"_showY",!0),l.default(r.default(t),"_showZ",!0),l.default(r.default(t),"updateMatrixWorld",(function(){var n=t._space;"scale"===t._mode&&(n="local");var o="local"===n?t._worldQuaternion:t.identityQuaternion;t.gizmo.translate.visible="translate"===t._mode,t.gizmo.rotate.visible="rotate"===t._mode,t.gizmo.scale.visible="scale"===t._mode,t.helper.translate.visible="translate"===t._mode,t.helper.rotate.visible="rotate"===t._mode,t.helper.scale.visible="scale"===t._mode;var i=[];i=(i=(i=i.concat(t.picker[t._mode].children)).concat(t.gizmo[t._mode].children)).concat(t.helper[t._mode].children);for(var l=function(e){var n=i[e];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(t._worldPosition);var r=void 0;if(r=t._camera.isOrthographicCamera?(t._camera.top-t._camera.bottom)/t._camera.zoom:t._worldPosition.distanceTo(t._cameraPosition)*Math.min(1.9*Math.tan(Math.PI*t._camera.fov/360)/t._camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*t._size/7),"helper"===n.tag)return n.visible=!1,"AXIS"===n.name?(n.position.copy(t._worldPositionStart),n.visible=!!t._axis,"X"===t._axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,0,0)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t._eye))>.9&&(n.visible=!1)),"Y"===t._axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t._eye))>.9&&(n.visible=!1)),"Z"===t._axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(o).multiply(t.tempQuaternion),Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t._eye))>.9&&(n.visible=!1)),"XYZE"===t._axis&&(t.tempQuaternion.setFromEuler(t.tempEuler.set(0,Math.PI/2,0)),t.alignVector.copy(t._rotationAxis),n.quaternion.setFromRotationMatrix(t.lookAtMatrix.lookAt(t.zeroVector,t.alignVector,t.unitY)),n.quaternion.multiply(t.tempQuaternion),n.visible=t._dragging),"E"===t._axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(t._worldPositionStart),n.visible=t._dragging):"END"===n.name?(n.position.copy(t._worldPosition),n.visible=t._dragging):"DELTA"===n.name?(n.position.copy(t._worldPositionStart),n.quaternion.copy(t._worldQuaternionStart),t.tempVector.set(1e-10,1e-10,1e-10).add(t._worldPositionStart).sub(t._worldPosition).multiplyScalar(-1),t.tempVector.applyQuaternion(t._worldQuaternionStart.clone().invert()),n.scale.copy(t.tempVector),n.visible=t._dragging):(n.quaternion.copy(o),t._dragging?n.position.copy(t._worldPositionStart):n.position.copy(t._worldPosition),t._axis&&(n.visible=-1!==t._axis.search(n.name))),"continue";if(n.quaternion.copy(o),"translate"===t._mode||"scale"===t._mode){var l=.99;"X"!==n.name&&"XYZX"!==n.name||Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t._eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t._eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t._eye))>l&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t._eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t._eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t._eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(t.alignVector.copy(t.unitX).applyQuaternion(o).dot(t._eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(t.alignVector.copy(t.unitY).applyQuaternion(o).dot(t._eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(t.alignVector.copy(t.unitZ).applyQuaternion(o).dot(t._eye)<0?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===t._mode&&(t.tempQuaternion2.copy(o),t.alignVector.copy(t._eye).applyQuaternion(t.tempQuaternion.copy(o).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(t.lookAtMatrix.lookAt(t._eye,t.zeroVector,t.unitY)),"X"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitX,Math.atan2(-t.alignVector.y,t.alignVector.z)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)),"Y"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitY,Math.atan2(t.alignVector.x,t.alignVector.z)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)),"Z"===n.name&&(t.tempQuaternion.setFromAxisAngle(t.unitZ,Math.atan2(t.alignVector.y,t.alignVector.x)),t.tempQuaternion.multiplyQuaternions(t.tempQuaternion2,t.tempQuaternion),n.quaternion.copy(t.tempQuaternion)));n.visible=n.visible&&(-1===n.name.indexOf("X")||t._showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||t._showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||t._showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||t._showX&&t._showY&&t._showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,t._enabled?t._axis&&(n.name===t._axis||t._axis.split("").some((function(e){return n.name===e}))?(n.material.opacity=1,n.material.color.lerp(new a.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new a.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new a.Color(1,1,1),.5))},u=0;u<i.length;u++)l(u);e.prototype.updateMatrixWorld.call(r.default(t))}));var n=new a.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:a.DoubleSide,fog:!1,toneMapped:!1}),o=new a.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),i=n.clone();i.opacity=.15;var u=n.clone();u.opacity=.33;var d=n.clone();d.color.set(16711680);var s=n.clone();s.color.set(65280);var c=n.clone();c.color.set(255);var p=n.clone();p.opacity=.25;var _=p.clone();_.color.set(16776960);var f=p.clone();f.color.set(65535);var m=p.clone();m.color.set(16711935),n.clone().color.set(16776960);var w=o.clone();w.color.set(16711680);var h=o.clone();h.color.set(65280);var y=o.clone();y.color.set(255);var v=o.clone();v.color.set(65535);var M=o.clone();M.color.set(16711935);var b=o.clone();b.color.set(16776960);var g=o.clone();g.color.set(7895160);var Q=b.clone();Q.opacity=.25;var P=new a.CylinderGeometry(0,.05,.2,12,1,!1),x=new a.BoxGeometry(.125,.125,.125),V=new a.BufferGeometry;V.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,0,0],3));var S,E=function(e,t){for(var n=new a.BufferGeometry,o=[],r=0;r<=64*t;++r)o.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return n.setAttribute("position",new a.Float32BufferAttribute(o,3)),n},Y={X:[[new a.Mesh(P,d),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new a.Mesh(P,d),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new a.Line(V,w)]],Y:[[new a.Mesh(P,s),[0,1,0],null,null,"fwd"],[new a.Mesh(P,s),[0,1,0],[Math.PI,0,0],null,"bwd"],[new a.Line(V,h),null,[0,0,Math.PI/2]]],Z:[[new a.Mesh(P,c),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new a.Mesh(P,c),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new a.Line(V,y),null,[0,-Math.PI/2,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.1,0),p.clone()),[0,0,0],[0,0,0]]],XY:[[new a.Mesh(new a.PlaneGeometry(.295,.295),_.clone()),[.15,.15,0]],[new a.Line(V,b),[.18,.3,0],null,[.125,1,1]],[new a.Line(V,b),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a.Mesh(new a.PlaneGeometry(.295,.295),f.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new a.Line(V,v),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new a.Line(V,v),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a.Mesh(new a.PlaneGeometry(.295,.295),m.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new a.Line(V,M),[.18,0,.3],null,[.125,1,1]],[new a.Line(V,M),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},X={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.2,0),i)]],XY:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.PlaneGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},Z={START:[[new a.Mesh(new a.OctahedronGeometry(.01,2),u),null,null,null,"helper"]],END:[[new a.Mesh(new a.OctahedronGeometry(.01,2),u),null,null,null,"helper"]],DELTA:[[new a.Line((S=new a.BufferGeometry,S.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,1,1],3)),S),u),null,null,null,"helper"]],X:[[new a.Line(V,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(V,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(V,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={X:[[new a.Line(E(1,.5),w)],[new a.Mesh(new a.OctahedronGeometry(.04,0),d),[0,0,.99],null,[1,3,1]]],Y:[[new a.Line(E(1,.5),h),null,[0,0,-Math.PI/2]],[new a.Mesh(new a.OctahedronGeometry(.04,0),s),[0,0,.99],null,[3,1,1]]],Z:[[new a.Line(E(1,.5),y),null,[0,Math.PI/2,0]],[new a.Mesh(new a.OctahedronGeometry(.04,0),c),[.99,0,0],null,[1,3,1]]],E:[[new a.Line(E(1.25,1),Q),null,[0,Math.PI/2,0]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),Q),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),Q),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),Q),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new a.Mesh(new a.CylinderGeometry(.03,0,.15,4,1,!1),Q),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new a.Line(E(1,1),g),null,[0,Math.PI/2,0]]]},A={AXIS:[[new a.Line(V,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={X:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a.Mesh(new a.TorusGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a.Mesh(new a.TorusGeometry(1.25,.1,2,24),i)]],XYZE:[[new a.Mesh(new a.SphereGeometry(.7,10,8),i)]]},j={X:[[new a.Mesh(x,d),[.8,0,0],[0,0,-Math.PI/2]],[new a.Line(V,w),null,null,[.8,1,1]]],Y:[[new a.Mesh(x,s),[0,.8,0]],[new a.Line(V,h),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new a.Mesh(x,c),[0,0,.8],[Math.PI/2,0,0]],[new a.Line(V,y),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new a.Mesh(x,_),[.85,.85,0],null,[2,2,.2]],[new a.Line(V,b),[.855,.98,0],null,[.125,1,1]],[new a.Line(V,b),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new a.Mesh(x,f),[0,.85,.85],null,[.2,2,2]],[new a.Line(V,v),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new a.Line(V,v),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new a.Mesh(x,m),[.85,0,.85],null,[2,.2,2]],[new a.Line(V,M),[.855,0,.98],null,[.125,1,1]],[new a.Line(V,M),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[1.1,0,0]]],XYZY:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[0,1.1,0]]],XYZZ:[[new a.Mesh(new a.BoxGeometry(.125,.125,.125),p.clone()),[0,0,1.1]]]},L={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new a.Mesh(x,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new a.Mesh(x,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new a.Mesh(x,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),i),[0,0,1.1]]]},G={X:[[new a.Line(V,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(V,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(V,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T=function(e){var t=new a.Object3D;for(var n in e)for(var o=e[n].length;o--;){var r=e[n][o][0].clone(),i=e[n][o][1],l=e[n][o][2],u=e[n][o][3],d=e[n][o][4];r.name=n,r.tag=d,i&&r.position.set(i[0],i[1],i[2]),l&&r.rotation.set(l[0],l[1],l[2]),u&&r.scale.set(u[0],u[1],u[2]),r.updateMatrix();var s=r.geometry.clone();s.applyMatrix4(r.matrix),r.geometry=s,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t};return t.gizmo={},t.picker={},t.helper={},t.add(t.gizmo.translate=T(Y)),t.add(t.gizmo.rotate=T(I)),t.add(t.gizmo.scale=T(j)),t.add(t.picker.translate=T(X)),t.add(t.picker.rotate=T(z)),t.add(t.picker.scale=T(L)),t.add(t.helper.translate=T(Z)),t.add(t.helper.rotate=T(A)),t.add(t.helper.scale=T(G)),t.picker.translate.visible=!1,t.picker.rotate.visible=!1,t.picker.scale.visible=!1,t}return i.default(t,e),t}(a.Object3D),s=function(e){function t(){var t;return t=e.call(this,new a.PlaneGeometry(1e5,1e5,2,2),new a.MeshBasicMaterial({visible:!1,wireframe:!0,side:a.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))||this,l.default(r.default(t),"isTransformControlsPlane",!0),l.default(r.default(t),"type","TransformControlsPlane"),l.default(r.default(t),"unitX",new a.Vector3(1,0,0)),l.default(r.default(t),"unitY",new a.Vector3(0,1,0)),l.default(r.default(t),"unitZ",new a.Vector3(0,0,1)),l.default(r.default(t),"tempVector",new a.Vector3),l.default(r.default(t),"dirVector",new a.Vector3),l.default(r.default(t),"alignVector",new a.Vector3),l.default(r.default(t),"tempMatrix",new a.Matrix4),l.default(r.default(t),"identityQuaternion",new a.Quaternion),l.default(r.default(t),"_cameraQuaternion",new a.Quaternion),l.default(r.default(t),"_worldPosition",new a.Vector3),l.default(r.default(t),"_worldQuaternion",new a.Quaternion),l.default(r.default(t),"_eye",new a.Vector3),l.default(r.default(t),"_axis",null),l.default(r.default(t),"_mode","translate"),l.default(r.default(t),"_space","world"),l.default(r.default(t),"updateMatrixWorld",(function(){var n=t._space;switch(t.position.copy(t._worldPosition),"scale"===t._mode&&(n="local"),t.unitX.set(1,0,0).applyQuaternion("local"===n?t._worldQuaternion:t.identityQuaternion),t.unitY.set(0,1,0).applyQuaternion("local"===n?t._worldQuaternion:t.identityQuaternion),t.unitZ.set(0,0,1).applyQuaternion("local"===n?t._worldQuaternion:t.identityQuaternion),t.alignVector.copy(t.unitY),t._mode){case"translate":case"scale":switch(t._axis){case"X":t.alignVector.copy(t._eye).cross(t.unitX),t.dirVector.copy(t.unitX).cross(t.alignVector);break;case"Y":t.alignVector.copy(t._eye).cross(t.unitY),t.dirVector.copy(t.unitY).cross(t.alignVector);break;case"Z":t.alignVector.copy(t._eye).cross(t.unitZ),t.dirVector.copy(t.unitZ).cross(t.alignVector);break;case"XY":t.dirVector.copy(t.unitZ);break;case"YZ":t.dirVector.copy(t.unitX);break;case"XZ":t.alignVector.copy(t.unitZ),t.dirVector.copy(t.unitY);break;case"XYZ":case"E":t.dirVector.set(0,0,0)}break;case"rotate":default:t.dirVector.set(0,0,0)}0===t.dirVector.length()?t.quaternion.copy(t._cameraQuaternion):(t.tempMatrix.lookAt(t.tempVector.set(0,0,0),t.dirVector,t.alignVector),t.quaternion.setFromRotationMatrix(t.tempMatrix)),e.prototype.updateMatrixWorld.call(r.default(t))})),t}return i.default(t,e),t}(a.Mesh);exports.TransformControls=u,exports.TransformControlsGizmo=d,exports.TransformControlsPlane=s;
