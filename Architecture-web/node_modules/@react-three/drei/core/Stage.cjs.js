"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-three/fiber");require("@babel/runtime/helpers/extends");var r=require("@babel/runtime/helpers/objectWithoutPropertiesLoose");require("three-stdlib");var i=require("three"),n=require("./ContactShadows.cjs.js");require("use-asset"),require("../helpers/environment-assets.cjs.js");var a=require("./Environment.cjs.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=o(r),u={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};exports.Stage=function(r){var o=r.children,c=r.controls,d=r.shadows,l=void 0===d||d,h=r.adjustCamera,m=void 0===h||h,f=r.environment,p=void 0===f?"city":f,v=r.contactShadow,w=void 0===v||v,b=r.intensity,y=void 0===b?1:b,g=r.preset,S=void 0===g?"rembrandt":g,j=r.shadowBias,x=void 0===j?0:j,E=r.contactShadowBlur,q=void 0===E?2:E,B=r.contactShadowOpacity,L=void 0===B?.5:B,C=s.default(r,["children","controls","shadows","adjustCamera","environment","contactShadow","intensity","preset","shadowBias","contactShadowBlur","contactShadowOpacity"]),M=u[S],O=t.useThree((function(e){return e.camera})),P=e.useRef(null),R=e.useRef(null),W=e.useState({radius:0,width:0,height:0}),_=W[0],k=_.radius,z=_.width,A=_.height,F=W[1];return e.useLayoutEffect((function(){P.current.position.set(0,0,0),P.current.updateWorldMatrix(!0,!0);var e=(new i.Box3).setFromObject(R.current),t=new i.Vector3,r=new i.Sphere,n=e.max.y-e.min.y,a=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),F({radius:r.radius,width:a,height:n}),P.current.position.set(-t.x,-t.y+n/2,-t.z)}),[o]),e.useLayoutEffect((function(){if(m){var e=k/(A>z?1.5:2.5);O.position.set(0,.5*k,2.5*k),O.near=.1,O.far=Math.max(5e3,4*k),O.lookAt(0,e,0),c&&c.current&&(c.current.target.set(0,e,0),c.current.update())}}),[k,A,z,m]),e.createElement("group",C,e.createElement("group",{ref:P},e.createElement("group",{ref:R},o)),w&&e.createElement(n.ContactShadows,{"rotation-x":Math.PI/2,opacity:L,width:2*k,height:2*k,blur:q,far:k/2}),p&&e.createElement(a.Environment,{preset:p}),e.createElement("ambientLight",{intensity:y/3}),e.createElement("spotLight",{penumbra:1,position:[M.main[0]*k,M.main[1]*k,M.main[2]*k],intensity:2*y,castShadow:l,"shadow-bias":x}),e.createElement("pointLight",{position:[M.fill[0]*k,M.fill[1]*k,M.fill[2]*k],intensity:y}))};
